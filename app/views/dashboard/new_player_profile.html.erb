<body class="bg-gray-900 text-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="text-center mb-8 mt-8">
                <%= link_to root_path do %>
                    <%= image_tag "logo_sem_texto.png", alt: "Logo", class: "mx-auto mb-4", height: 70, width: 70 %>
                <% end %>
                <% if user_signed_in? and (current_user.club? or current_user.board?) %>
                    <p class="text-indigo-100 font-bold mt-2">Crie uma conta para um jogador do seu clube</p>
                <% else %>
                    <p class="text-indigo-100 font-bold mt-2">Crie a sua conta de jogador</p>
                <% end %>
            </div>
            <!-- Steps -->
            <div class="flex justify-between items-center mt-6 mb-8 px-10 relative">
                <div class="absolute left-[calc(12.5%)] right-[calc(12.5%)] top-4 h-1 bg-gray-700 -z-10">
                    <div class="h-full bg-primary-500 progress-line" style="width: 0%"></div>
                </div>
                <div class="step active" data-step="1">
                    <div class="w-8 h-8 rounded-full bg-primary-500 flex items-center justify-center text-white font-medium mx-auto transition-all duration-300">1</div>
                    <p class="text-xs mt-1 text-gray-400 transition-all duration-300">Conta</p>
                </div>
                <div class="step" data-step="2">
                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 font-medium mx-auto transition-all duration-300">2</div>
                    <p class="text-xs mt-1 text-gray-400 transition-all duration-300">Perfil</p>
                </div>
                <div class="step" data-step="3">
                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-gray-400 font-medium mx-auto transition-all duration-300">3</div>
                    <p class="text-xs mt-1 text-gray-400 transition-all duration-300">Criar</p>
                </div>
            </div>
    </div>
    
    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { class: "space-y-4", id: "multiStepForm", novalidate: true }) do |f| %>
        

    <% if resource.errors.any? %> 
        <div class="flex p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-200 dark:bg-gray-800 dark:text-red-400" role="alert" id="alert-close"> 
            <svg class="shrink-0 inline w-4 h-4 me-3 mt-[2px]" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20"> 
                <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/> 
            </svg> 
            <span class="sr-only">Danger</span> 
            <div> 
                <span class="font-medium">Houve os seguintes erros:</span> 
                <ul class="mt-1.5 list-disc list-inside"> 
                <% resource.errors.full_messages.each do |msg| %> 
                    <li><%= msg %></li> 
                <% end %> 
                </ul> 
            </div> 
            <button type="button" class="ms-auto -mx-1.5 -my-1.5 rounded focus:ring-2 focus:ring-brand-medium hover:bg-brand-soft inline-flex items-center justify-center h-8 w-8" data-dismiss-target="#alert-close" aria-label="Close" > 
                <span class="sr-only">Close</span> 
                <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 17.94 6M18 18 6.06 6"/>
                </svg> 
            </button> 
        </div>

        <script>
            const closeBtn = document.querySelector('[data-dismiss-target="#alert-close"]');
            const alertBox = document.getElementById('alert-close');

            if (closeBtn && alertBox) {
                closeBtn.addEventListener('click', function() {
                    alertBox.style.opacity = '0';
                    alertBox.style.transition = 'opacity 0.3s ease';
                    setTimeout(() => {
                        alertBox.style.display = 'none';
                    }, 300);
                });
            }
        </script>
         
    <% end %>
        
        <%= f.hidden_field :role,
            value: "Player" %>
        <%= hidden_field_tag :selected_sport, params[:selected_sport] %>  <!-- ADICIONADO -->
        <%= hidden_field_tag :selected_team, params[:selected_team] %>    <!-- ADICIONADO -->

    
<!--------------------------------------------------------------- Step 1 ----------------------------------------------------------------------------->


            <div class="step-content" data-step="1">
                <!-- Email -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Email</label>
                    <%= f.email_field :email,
                        autofocus: true,
                        autocomplete: "email",
                        class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        placeholder: "sportX@email.com",
                        pattern: User::REGEX_EMAIL,
                        required: true %>
                </div>
                <!-- Password -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Password</label>
                    <%= f.password_field :password,
                        autocomplete: "new-password",
                        id: "password",
                        class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        placeholder:"••••••••" %>

                    <div class="relative">
                        <button type="button" id="toggle-password" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-indigo-500">
                            <!-- Olho aberto -->
                            <svg id="eye-open-password" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <!-- Olho fechado  -->
                            <svg id="eye-closed-password" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.293-3.95M6.634 6.634A9.956 9.956 0 0112 5c4.477 0 8.268 2.943 9.542 7a9.956 9.956 0 01-4.293 5.032M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />
                            </svg>
                        
                        
                        </button>
                    </div>
                </div>
                <!-- Confirmar Password -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Confirmar Password</label>
                    <%= f.password_field :password_confirmation,
                        autocomplete: "new-password",
                        id: "password-confirmation",
                        class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        placeholder:"••••••••" %>

                    <div class="relative"> 
                        <button type="button" id="toggle-password-confirmation" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-indigo-500">
                            <!-- Olho aberto -->
                            <svg id="eye-open-password-confirmation" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                            </svg>
                            <!-- Olho fechado  -->
                            <svg id="eye-closed-password-confirmation" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.956 9.956 0 012.293-3.95M6.634 6.634A9.956 9.956 0 0112 5c4.477 0 8.268 2.943 9.542 7a9.956 9.956 0 01-4.293 5.032M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />
                            </svg>
                        
                        </button>
                    </div>
                </div>
                    <div class="text-left text-xs text-red-400 py-2">
                        * -> Campo Obrigatorio
                    </div>
                <div class="pt-4">
                    <button type="button" class="login-btn w-full bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg hover:shadow-primary-500/30 next-step" data-next="2">
                        Continuar
                    </button>
                </div>
            
            
    </div>


<!--------------------------------------------------------------- Step 2 ----------------------------------------------------------------------------->


        <%= f.fields_for :player_profile do |pp| %>
        
            <div class="step-content hidden" data-step="2"> 
                <% sport = params[:selected_sport] %>
                <% team = params[:selected_team] %>

                <!-- Desporto e equipa -->

                <% if user_signed_in? and (current_user.club? or current_user.board?) %>
                    <%= pp.fields_for :player_teams do |pt| %>
                        
                        <% if sport != nil and team!= nil %>

                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Desporto</label>
                                <%= pp.hidden_field :sport, value: sport, id: "sport_select" %>
                                <select disabled class="w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent">
                                    <option value=""> <%= sport=='football' ? "Futebol" : "Andebol"  %> </option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-1">Equipa</label>
                                <%= pt.hidden_field :club_team_id, value: team %>
                                <select disabled class="w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent">
                                    <option value=""> <%= ClubTeam.find(team).name  %> </option>
                                </select>
                            </div>
                            

                        <% else %>

                            <% if (user_signed_in? and current_user.club? and current_user.club_profile.has_teams_in_both?) or (user_signed_in? and current_user.board? and current_user.board_profile.club_profile.has_teams_in_both?) %>
                                <div data-controller="sports" >
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Desporto</label>
                                        <%= pp.select :sport,
                                            [["Futebol", "football"], ["Andebol", "handball"]],
                                            {selected: "football", include_blank: false},
                                            { id: "sport_select", class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent", data: {action: "change->sports#change"} } %>
                                    </div>

                                    <% all_club_teams = current_user.club? ? current_user.club_profile.club_teams : current_user.board_profile.club_profile.club_teams %>
                                    <div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Equipa</label>
                                                <%= pt.select :club_team_id,
                                                [],
                                                { prompt: "Escolher equipa..." },
                                                {
                                                id: "team_select",
                                                class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white",
                                                data: { "sports-target": "teamSelect" }
                                                } %>
                                            </div>
                                    </div>
                                </div>

                            <% elsif (user_signed_in? and current_user.club? and current_user.club_profile.has_football_teams?) or (user_signed_in? and current_user.board? and current_user.board_profile.club_profile.has_football_teams?) %>
                                
                                <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Desporto</label>
                                <%= pp.hidden_field :sport, value: 'football', id: "sport_select" %>
                                <select disabled class="w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent">
                                    <option value=""> Futebol </option>
                                </select>

                                <% all_club_teams = current_user.club? ? current_user.club_profile.club_teams.where(sport_id: 2) : current_user.board_profile.club_profile.club_teams.where(sport_id: 2) %>
                                <div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Equipa</label>
                                        <%= pt.collection_select :club_team_id, all_club_teams, :id, :name, { prompt: "Escolher equipa..." }, class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent" %>
                                    </div>
                                </div>

                            <% elsif (user_signed_in? and current_user.club? and current_user.club_profile.has_handball_teams?) or (user_signed_in? and current_user.board? and current_user.board_profile.club_profile.has_handball_teams?) %>
                                
                                <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Desporto</label>
                                <%= pp.hidden_field :sport, value: 'handball', id: "sport_select" %>
                                <select disabled class="w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent">
                                    <option value=""> Andebol </option>
                                </select>

                                <% all_club_teams = current_user.club? ? current_user.club_profile.club_teams.where(sport_id: 3) : current_user.board_profile.club_profile.club_teams.where(sport_id: 3) %>
                                <div>
                                    <div data-controller="sports">
                                        <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Equipa</label>
                                        <%= pt.collection_select :club_team_id, all_club_teams, :id, :name, { prompt: "Escolher equipa..." }, class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent" %>
                                    </div>
                                </div>
                            <% end %>
                        <% end %>
                    <% end %>
                <% else %>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Desporto</label>
                        <%= pp.select :sport,
                            [["Futebol", "football"], ["Andebol", "handball"]],
                            {selected: "football", include_blank: false},
                            { id: "sport_select", class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent", data: {action: "change->sports#change"} } %>
                    </div>
                <% end %>


                <!-- Nome -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Nome</label>
                    <%= pp.text_field :name,
                        class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        placeholder:"Ex. Juvesvaldo Ribeiro",
                        required: true %>
                </div>

                <% if user_signed_in? and current_user.club? %>
                    <%= pp.hidden_field :club_profile_id, value: current_user.club_profile.id %>
                <% elsif user_signed_in? and current_user.board? %>
                    <%= pp.hidden_field :club_profile_id, value: current_user.board_profile.club_profile.id %>
                <% end %>

                <!-- Data de nascimento -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Data de nascimento</label>
                    <%= pp.date_field :birth_date,
                        class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        max: PlayerProfile::MIN_AGE,
                        required: true %>
                </div>
                <!-- Posição -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label required-label">Posição</label>
                    <%= pp.select :position,
                        [],
                        {},
                        { id: "position_select", class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent", required: true } %>
                </div>
                <!-- Posição Secundária -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Posição Secundária</label>
                    <%= pp.select :secondary_position,
                        [],
                        { include_blank: true },
                        { id: "secondary_position_select", class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent" } %>
                </div>
                <!-- Pé / Mão dominante -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Pé / Mão predominante</label>
                    <%= pp.select :dominant_foot_or_hand,
                        PlayerProfile::DOMINANT,
                        { selected: PlayerProfile::DOMINANT.first, include_blank:false},
                        class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent" %> 
                </div>
                <!-- Biografia -->
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Biografia</label>
                    <%= pp.textarea :bio,
                        class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        placeholder:"Escreve uma breve descrição sobre ti. A informação estará visível para todos no teu perfil" %>
                </div>
                <!-- Contacto -->
                
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1 required-label">Contacto</label>
                    <%= pp.text_field :contact,
                        id: "player-contact",
                        class: "w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
                        pattern: PlayerProfile::REGEX_NUM_TELEMOVEL,
                        placeholder: "Ex. 123123123",
                        maxlength: 9, 
                        required: true %> 
                </div>

                
                    <div class="text-left text-xs text-red-400 py-2">
                        * -> Campo Obrigatorio
                    </div>
                <div class="flex justify-between pt-4">
                    <button type="button" class="w-32 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg prev-step" data-prev="1">
                        Voltar
                    </button>
                    <button type="button" class="login-btn w-32 bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg hover:shadow-primary-500/30 next-step" data-next="3">
                        Continuar
                    </button>
        </div>
            </div>
                    

<!--------------------------------------------------------------- Step 3 ----------------------------------------------------------------------------->



        <div class="step-content hidden" data-step="3">
            <div class="file-upload-wrapper flex flex-col items-center gap-4 w-full max-w-2xl mx-auto" aria-live="polite">
                <label class="block text-sm font-medium text-gray-400 mb-1 mt-6">Foto de perfil e banner</label>
                <div class="relative w-full max-w-2xl">

                <!-- Banner -->
                <div class="relative w-full h-40 rounded-lg overflow-hidden shadow-lg">
                    <%= image_tag "default_banner.jpg",
                        id: "club_banner_preview",
                        alt: "Pré-visualização do banner",
                        class: "w-full h-full object-cover cursor-pointer" %>

                    <%= pp.file_field :banner_picture,
                        id: "club_banner_picture",
                        class: "file-upload-input sr-only",
                        accept: "image/*" %>
                    
                    <button type="button" id="remove-banner-btn" class="hidden absolute inset-0 bg-red-500 bg-opacity-0 hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    </button>
                </div>

                <!-- Foto de Perfil -->
                <div class="absolute top-20 left-8 w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg bg-gray-100 group">
                    <%= image_tag "default_pp.jpg",
                        id: "pp_profile_preview",
                        alt: "Pré-visualização da imagem de perfil",
                        class: "w-full h-full object-cover cursor-pointer" %>

                    <%= pp.file_field :profile_picture,
                        id: "pp_profile_picture",
                        class: "file-upload-input sr-only",
                        accept: "image/*" %>
                    
                    <button type="button" id="remove-profile-btn" class="absolute inset-0 bg-red-500 bg-opacity-0 hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                    </button>
                </div>
                </div>
            </div>
            <br><br><br><br>
            <div class="flex justify-between pt-4">
                <button type="button" class="w-32 bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg prev-step" data-prev="2">
                Voltar
                </button>
                <%= f.submit "Criar Conta",
                    class:"login-btn w-32 bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg hover:shadow-primary-500/30" %>
            </div>
        </div>
    <% end %> 
<% end %>

    <br>

    <div class="text-center text-sm text-gray-400">
        <%= link_to "Escolher tipo de conta", choose_account_type_path(selected_sport: params[:selected_sport], selected_team: params[:selected_team]), class: "text-primary-500 hover:underline font-medium" %>
        <br>
        <% if !user_signed_in? %>
            Já tem uma conta? <%= link_to 'Entrar', new_user_session_path, class: "text-primary-500 hover:underline font-medium" %>
        <% end %>
    </div>


    
<!--------------------------------------------------------------- Scripts ----------------------------------------------------------------------------->


        <!-- Script para passar os steps -->

        <script>
            document.addEventListener('DOMContentLoaded', function() {
            const steps = Array.from(document.querySelectorAll('.step'));
            const stepContents = Array.from(document.querySelectorAll('.step-content'));
            const progressLine = document.querySelector('.progress-line');

            function showStep(stepNum) {
                // mostrar conteúdo
                stepContents.forEach(el => el.classList.add('hidden'));
                const content = document.querySelector(`.step-content[data-step="${stepNum}"]`);
                if (content) content.classList.remove('hidden');

                // atualizar indicadores
                steps.forEach(s => {
                const n = parseInt(s.dataset.step, 10);
                const circle = s.querySelector('div');
                if (n <= stepNum) {
                    s.classList.add('active');
                    if (circle) {
                    circle.classList.remove('bg-gray-700','text-gray-400');
                    circle.classList.add('bg-primary-500','text-white');
                    }
                } else {
                    s.classList.remove('active');
                    if (circle) {
                    circle.classList.add('bg-gray-700','text-gray-400');
                    circle.classList.remove('bg-primary-500','text-white');
                    }
                }
                });

                // atualizar linha de progresso
                const totalSteps = steps.length;
                const completed = Math.max(0, stepNum - 1);
                const percent = (completed / (totalSteps - 1)) * 100;
                if (progressLine) progressLine.style.width = `${percent}%`;
            }

            // inicializar
            showStep(1);

            // next / prev handlers 
            document.querySelectorAll('.next-step').forEach(btn => {
                btn.addEventListener('click', () => {
                const next = parseInt(btn.dataset.next, 10);
                if (!isNaN(next)) showStep(next);
                });
            });

            document.querySelectorAll('.prev-step').forEach(btn => {
                btn.addEventListener('click', () => {
                const prev = parseInt(btn.dataset.prev, 10);
                if (!isNaN(prev)) showStep(prev);
                });
            });
            });
        </script>

        <!-- Script para poder escolher as posições consoante o desporto -->

        <script>
            document.addEventListener("DOMContentLoaded", () => {
            const sportSelect = document.getElementById("sport_select");
            const positionSelect = document.getElementById("position_select");
            const secondaryPositionSelect = document.getElementById("secondary_position_select");

            const positions = {
                football: ["Guarda-Redes", "Lateral Direito", "Lateral Esquerdo", "Central", "Médio Centro", "Médio Ofensivo", "Médio Defensivo", "Extremo Direito", "Extremo Esquerdo", "Ponta de lança"],
                handball: ["Guarda-Redes", "Central", "Lateral Esquerdo", "Lateral Direito", "Ponta Esquerda", "Pivô", "Ponta Direita"]
            };

            const populateOptions = (selectEl, opts, preserveValue) => {
                const prev = preserveValue ? selectEl.value : null;
                selectEl.innerHTML = "";

                // opção explícita para "Nenhuma posição secundária" (envia "" para o server)
                if (selectEl === secondaryPositionSelect) {
                const noneOpt = document.createElement("option");
                noneOpt.value = "";
                noneOpt.text = "Nenhuma posição secundária";
                selectEl.appendChild(noneOpt);
                }

                opts.forEach(pos => {
                const o = document.createElement("option");
                o.value = pos;
                o.text = pos;
                selectEl.appendChild(o);
                });

                // restaura seleção anterior (inclui caso seja "")
                if (prev !== null) {
                // se prev não existir entre as opções, ficará vazio como previsto
                selectEl.value = prev;
                }
            };

            const syncSecondary = () => {
                const primary = positionSelect.value;
                Array.from(secondaryPositionSelect.options).forEach(opt => {
                // permite sempre a opção vazia/"Nenhuma posição secundária"
                if (opt.value === "") {
                    opt.disabled = false;
                    return;
                }
                opt.disabled = (opt.value === primary);
                });

                // se o valor atual da secundária for igual à primária (ou for uma opção desativada),
                // escolhe a primeira disponível (ou deixa como "")
                if (secondaryPositionSelect.value === primary || Array.from(secondaryPositionSelect.options).find(o => o.selected && o.disabled)) {
                const firstAvailable = Array.from(secondaryPositionSelect.options).find(o => !o.disabled);
                secondaryPositionSelect.value = firstAvailable ? firstAvailable.value : "";
                }
            };

            const updatePositions = () => {
                const selectedSport = sportSelect ? sportSelect.value : null;
                const opts = positions[selectedSport] || [];
                populateOptions(positionSelect, opts, true);
                populateOptions(secondaryPositionSelect, opts, true);
                syncSecondary();
            };

            if (positionSelect) positionSelect.addEventListener("change", syncSecondary);
            if (sportSelect) sportSelect.addEventListener("change", updatePositions);

            // Inicializar caso já haja valor
            updatePositions();
            });
        </script>

        <!-- Script foto de perfil e banner -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const profileInput = document.getElementById('pp_profile_picture');
                const profilePreview = document.getElementById('pp_profile_preview');
                const removeProfileBtn = document.getElementById('remove-profile-btn');
                const originalProfileSrc = profilePreview ? profilePreview.src : '';
                let hasProfileImage = false;

                if (profileInput && profilePreview && removeProfileBtn) {
                // Inicializar: garantir que o botão está hidden
                removeProfileBtn.classList.add('hidden');

                profileInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        profilePreview.src = ev.target.result;
                        hasProfileImage = true;
                        removeProfileBtn.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                    }
                });

                profilePreview.addEventListener('click', () => {
                    if (!hasProfileImage) {
                    profileInput.click();
                    }
                });

                removeProfileBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    profileInput.value = '';
                    profilePreview.src = originalProfileSrc;
                    hasProfileImage = false;
                    removeProfileBtn.classList.add('hidden');
                });
                }

                const bannerInput = document.getElementById('club_banner_picture');
                const bannerPreview = document.getElementById('club_banner_preview');
                const removeBannerBtn = document.getElementById('remove-banner-btn');
                const originalBannerSrc = bannerPreview ? bannerPreview.src : '';

                if (bannerInput && bannerPreview) {
                bannerInput.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        bannerPreview.src = ev.target.result;
                        removeBannerBtn.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                    }
                });

                bannerPreview.addEventListener('click', () => {
                    bannerInput.click();
                });

                if (removeBannerBtn) {
                    removeBannerBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bannerInput.value = '';
                    bannerPreview.src = originalBannerSrc;
                    removeBannerBtn.classList.add('hidden');
                    });
                }
                }
            });
        </script>

        <!-- Script de mostrar password -->

        <script>
            document.addEventListener("DOMContentLoaded", function() {
                const toggleButtons = [
                    {
                        input: document.getElementById("password"),
                        button: document.getElementById("toggle-password"),
                        eyeOpen: document.getElementById("eye-open-password"),
                        eyeClosed: document.getElementById("eye-closed-password")
                    },
                    {
                        input: document.getElementById("password-confirmation"),
                        button: document.getElementById("toggle-password-confirmation"),
                        eyeOpen: document.getElementById("eye-open-password-confirmation"),
                        eyeClosed: document.getElementById("eye-closed-password-confirmation")
                    }
                ];

                toggleButtons.forEach(({input, button, eyeOpen, eyeClosed}) => {
                    button.addEventListener("click", function() {
                        if (input.type === "password") {
                            input.type = "text";
                            eyeOpen.classList.add("hidden");
                            eyeClosed.classList.remove("hidden");
                        } else {
                            input.type = "password";
                            eyeOpen.classList.remove("hidden");
                            eyeClosed.classList.add("hidden");
                        }
                    });
                });
            });
        </script>


        <!-- Configuração da cor principal e secundária do tailwind -->

        <script>
            tailwind.config = {
                darkMode: 'class',
                theme: {
                    extend: {
                        colors: {
                            primary: {
                                500: '#6366f1',
                            },
                            secondary: {
                                500: '#8b5cf6',
                            }
                        }
                    }
                }
            }
        </script>

<!--------------------------------------------------------------- CSS ----------------------------------------------------------------------------->        

        <!-- CSS dos steps -->

        <style>
            .step.active p {
                color: #6366f1;
            }
            .step-content {
                transition: all 0.3s ease;
                animation: fadeIn 0.5s ease;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .progress-line {
                transition: width 0.5s ease;
            }
        </style>
    
    <!-- CSS para alinhar botão de ver password -->

    <style>
        #toggle-password, #toggle-password-confirmation {
            top: -20px; 
        }
    </style>
