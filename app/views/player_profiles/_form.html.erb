


<div class="bg-gray-900 text-gray-100 min-h-screen flex flex-col items-center justify-center p-4">
  <div class="text-center mb-6">
      <div class="text-center">
              <%= image_tag "logo_sem_texto.png", alt: "Logo", class: "mx-auto mb-4", height: 70, width: 70 %>
          <p class="text-indigo-100 font-bold mt-2">Editar Perfil</p>
      </div>
  </div>

  <div class="bg-gray-800 p-8 rounded-xl shadow-lg max-w-2xl w-full mx-auto">
    <%= form_with(model: player_profile, class: "space-y-6") do |form| %>
      <% if player_profile.errors.any? %>
        <div id="error_explanation" class="bg-red-900 bg-opacity-50 border border-red-700 text-red-300 px-4 py-3 rounded-lg" role="alert">
          <h2 class="font-bold text-lg mb-2"><%= pluralize(player_profile.errors.count, "erro") %> impediu que as alterações fossem guardadas:</h2>
          <ul class="list-disc list-inside text-sm">
            <% player_profile.errors.each do |error| %>
              <li><%= error.full_message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="relative w-full max-w-2xl">

                      <!-- Banner -->
                      <div class="relative w-full h-40 rounded-lg overflow-hidden shadow-lg group">
                        <% if player_profile.banner_picture.attached? %>
                          <%= image_tag url_for(player_profile.banner_picture),
                          id: "player_banner_preview",
                          alt: "Pré-visualização do banner do playere",
                          class: "w-full h-full object-cover cursor-pointer" %>
                        <% else %>
                          <%= image_tag "default_banner.jpg",
                          id: "player_banner_preview",
                          alt: "Pré-visualização do banner do playere",
                          class: "w-full h-full object-cover cursor-pointer" %>
                        <% end %>

                        <%= form.file_field :banner_picture, id: "player_banner_picture", class: "file-upload-input sr-only", accept: "image/*" %>

                        <button type="button" id="add-banner-btn" class="<%= player_profile.banner_picture.attached? ? 'hidden' : '' %> absolute inset-0 bg-blue-500 bg-opacity-0 group-hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                          </svg>
                        </button>

                        <button type="button" id="remove-banner-btn" class="<%= player_profile.banner_picture.attached? ? '' : 'hidden' %> absolute inset-0 bg-red-500 bg-opacity-0 group-hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </div>


                      <!-- Foto de Perfil  -->
                      <div class="absolute top-20 left-8 w-32 h-32 rounded-full overflow-hidden border-4 border-white shadow-lg bg-gray-100 group">
                        <% if player_profile.profile_picture.attached? %>
                          <%= image_tag url_for(player_profile.profile_picture),
                          id: "pp_profile_preview",
                          alt: "Pré-visualização da imagem de perfil",
                          class: "w-full h-full object-cover cursor-pointer" %>
                        <% else %>
                          <%= image_tag "default_pp.jpg",
                          id: "pp_profile_preview",
                          alt: "Pré-visualização da imagem de perfil",
                          class: "w-full h-full object-cover cursor-pointer" %>
                        <% end %>

                        <%= form.file_field :profile_picture, id: "pp_profile_picture", class: "file-upload-input sr-only", accept: "image/*" %>

                        <button type="button" id="add-profile-btn" class="<%= player_profile.profile_picture.attached? ? 'hidden' : '' %> absolute inset-0 bg-blue-500 bg-opacity-0 hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                          </svg>
                        </button>

                        <button type="button" id="remove-profile-btn" class="<%= player_profile.profile_picture.attached? ? '' : 'hidden' %> absolute inset-0 bg-red-500 bg-opacity-0 hover:bg-opacity-90 text-white font-medium transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                          </svg>
                        </button>
                      </div>
      </div>

      <div>
        <%= form.label :name, "Nome do playere", class: "block text-sm font-medium text-gray-400 mb-1 mt-16" %>
        <%= form.text_field :name,
            class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
            placeholder:"Ex. SportX FC" %>
      </div>

      <div>
        <%= form.label :bio, "Biografia", class: "block text-sm font-medium text-gray-400 mb-1" %>
        <%= form.textarea :bio,
            rows: 6,
            class:"w-full bg-gray-800 rounded-md px-4 py-2 text-white border border-gray-700 focus:ring-2 focus:ring-secondary-500 focus:border-transparent",
            placeholder:"Escreva uma breve descrição sobre o playere. A informação estará visível para todos no perfil" %>
      </div>

      <div class="flex gap-4 pt-4">
        <%= link_to player_profile_path(player_profile), class: "w-full bg-red-700 hover:bg-red-800 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg hover:shadow-primary-500/30 flex items-center justify-center gap-2" do %>
            <i data-feather="arrow-left"></i>
            <span>Descartar Alterações</span>
        <% end %>
        <%= form.submit "Guardar Alterações", class: "w-full bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded-md transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg hover:shadow-primary-500/30" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Profile picture
    const profileInput = document.getElementById('pp_profile_picture');
    const profilePreview = document.getElementById('pp_profile_preview');
    const removeProfileBtn = document.getElementById('remove-profile-btn');
    const addProfileBtn = document.getElementById('add-profile-btn');

    if (profilePreview && removeProfileBtn && addProfileBtn) {
      addProfileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        profileInput.click();
      });

      if (profileInput) {
        profileInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              profilePreview.src = ev.target.result;
              removeProfileBtn.classList.remove('hidden');
              addProfileBtn.classList.add('hidden');
              const rem = document.querySelector('input[name="player_profile[remove_profile_picture]"]');
              if (rem) rem.value = '';
            };
            reader.readAsDataURL(file);
          }
        });
      }

      profilePreview.addEventListener('click', () => {
        if (profileInput) profileInput.click();
      });

      removeProfileBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (profileInput) profileInput.value = '';
        profilePreview.src = '<%= image_path("default_pp.jpg") %>';
        removeProfileBtn.classList.add('hidden');
        addProfileBtn.classList.remove('hidden');
        let hidden = document.querySelector('input[name="player_profile[remove_profile_picture]"]');
        if (!hidden) {
          hidden = document.createElement('input');
          hidden.type = 'hidden';
          hidden.name = 'player_profile[remove_profile_picture]';
          document.querySelector('form').appendChild(hidden);
        }
        hidden.value = '1';
      });
    }

    // Banner
    const bannerInput = document.getElementById('player_banner_picture');
    const bannerPreview = document.getElementById('player_banner_preview');
    const removeBannerBtn = document.getElementById('remove-banner-btn');
    const addBannerBtn = document.getElementById('add-banner-btn');

    if (bannerPreview && removeBannerBtn && addBannerBtn) {
      addBannerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        bannerInput.click();
      });

      if (bannerInput) {
        bannerInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file && file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              bannerPreview.src = ev.target.result;
              removeBannerBtn.classList.remove('hidden');
              addBannerBtn.classList.add('hidden');
              const rem = document.querySelector('input[name="player_profile[remove_banner_picture]"]');
              if (rem) rem.value = '';
            };
            reader.readAsDataURL(file);
          }
        });
      }

      bannerPreview.addEventListener('click', () => {
        if (bannerInput) bannerInput.click();
      });

      removeBannerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        if (bannerInput) bannerInput.value = '';
        bannerPreview.src = '<%= image_path("default_banner.jpg") %>';
        removeBannerBtn.classList.add('hidden');
        addBannerBtn.classList.remove('hidden');
        let hidden = document.querySelector('input[name="player_profile[remove_banner_picture]"]');
        if (!hidden) {
          hidden = document.createElement('input');
          hidden.type = 'hidden';
          hidden.name = 'player_profile[remove_banner_picture]';
          document.querySelector('form').appendChild(hidden);
        }
        hidden.value = '1';
      });
    }
  });
</script>
